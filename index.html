<!DOCTYPE html>
<html lang="en">
      <script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
      <head> 
            <title> Data Visualization _ CIS569 </title> 
            <meta charset="utf-8"> 
            <link rel="stylesheet" type= "text/css" href="styles.css">
      </head> 
      <body> 
            <h2>Data Visualization _ CIS569</h2>
            
            <div class="split left" style="height:100%">
                  <svg id='list'></svg>
            </div>
                
            <div class="split right">
                  <svg id='detail'></svg>
            </div>

            <svg_test></svg_test> 

            <h3>Print all of Title</h3>
            <div id='filename_id'>  </div>
            <h3>Print all of Contents</h3>
           


      </body> 
</html>
<script src = 'd3_function.js'> </script> 

<script>
      let fileNames = null;
      main();

      function main(){
            fileNames = getFileNames();

            //  initialize the view box for the list
            let vbStr = "0 0 100 " + fileNames.length.toString();
            let list = d3.select('#list');
            list.style('width','70vw')
                  .style('height',fileNames.length * 12)
                  .attr('viewBox', vbStr)
            
            let detail = d3.select('#detail');
            detail.style('width','70vw')
                  .style('height',fileNames.length * 12)
                  .attr('viewBox', vbStr)
            
            // draw the list
            drawList();
      }

      function drawList(){
            let list = d3.select('#list');

            // remove all the text elements present
            list.selectAll('text').remove();

            // add text elements based on current file name list
            list.selectAll('text')
                  .data(fileNames)
                  .enter()
                  .append('text')
                  .text(function(d){return d;})
                  .attr('x',function (){
                        return 1
                  })
                  .attr('y',function (d,i){
                        return i;
                  })
                  .style('font-size','.9pt')
                  .on('mouseenter', function (mouseData, d) {
                        try {
                        d3.select(this)
                              .style('background-color', 'rgb(247, 244, 241)')
                              .style('border', 'solid 1px black');
                        } catch {}
                        })
                  .on('mouseleave', function (mouseData, d) {
                        try {
                        d3.select(this)
                              .style('background-color', 'rgba(0,0,0,0)')
                              .style('border', 'solid 0px black');
                        } catch {}
                        })
                  .call(d3.drag()
                        .on("start", dragstarted)
                        .on("drag", dragged)
                        .on("end", dragended)
                  )
      }

      function dragstarted(d) {
            d3.select(this)
            .attr('fill', "red")
      }

      function dragged(d,i) {
            console.log(d3.event.x);

            // if in list box
            if(d3.event.x < 20){
                  // adjust x and y of object being dragged
                  d3.select(this)
                        .attr('x',d3.event.x)
                        .attr('y',d3.event.y)
            }
            // then add '+' to detail pane
            else{
                  let detail = d3.select('#detail');
                  detail.selectAll('text').remove();
                  detail.append('text')
                        .text("+ " + fileNames[i])
                        .attr('x',d3.event.x - 20)
                        .attr('y',d3.event.y)
                        .attr('fill','red')
                        .style('font-size','2pt')
            }
      }

      function dragended(d, i) {
            let selectedFile  = fileNames[i];
            console.log(selectedFile);

            // decide if we are re-ordering list or displaying file
            // based on how far right the object is dragged
            if(d3.event.x < 20){
                  // get the new index from the event's 'y'
                  let newY = Math.ceil(d3.event.y);
                  if(newY < 0){newy = 0};
                  if(newY > fileNames.length -1 ){newY = fileNames.length -1};
                  
                  // remove i from fileNames array
                  fileNames.splice(i,1);

                  // splice filenames array in correct order
                  fileNames.splice(newY,0,selectedFile);
            }
            else{
                  // get the text of the file to display
                  d3.text(selectedFile,function(error,data)
                        {
                              if(error){
                                    return console.error(error);
                              }
                              console.log(data);
                              let detail = d3.select('#detail');
                              detail.selectAll('text').remove();
                              detail.selectAll('foreignObject').remove();
                              detail.append("foreignObject")
                                    .attr("width", "90%")
                                    .attr("height", "90%")
                                    .append("xhtml:body")
                                    .style("font", "2px 'Helvetica Neue'")
                                    .html("<div>"+ data + "</div>")
                        });
            }
            // redraw the list
            drawList();
      }
</script>